<!DOCTYPE html>
<html>
<head>
<title>Brad Johnson: ActiveRecord Models</title>
<meta content='This post is a writeup of a RailsSchool class on 14-08-19 on ActiveRecord models. What is a model? In web programming, model generally refers to...' name='description'>
<meta charset='utf-8'>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<meta content='IE=edge' http-equiv='X-UA-Compatible'>
<meta content='True' name='HandheldFriendly'>
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
<link href="/images/favicon.ico" rel="icon" type="image/ico" />
<link href="/stylesheets/application.css" rel="stylesheet" type="text/css" />
<link href='//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400' rel='stylesheet' type='text/css'>
</head>
<body class='post-template nav-closed'>
<div class='nav'>
<h3 class='nav-title'>Menu</h3>
<a class='nav-close' href='#'>
<span class='hidden'>Close</span>
</a>
<ul>
<li class='nav-home' role='presentation'>
<a href='/'>Home</a>
</li>
<li class='nav-github' role='presentation'>
<a href='https://github.com/cdale77'>GitHub</a>
</li>
</ul>
<a class='subscribe-button icon-feed' href='/feed.xml'>Subscribe</a>
</div>
<span class='nav-cover'></span>

<div class='site-wrapper'>
<header class='main-header no-cover post-head'>
<nav class='main-nav clearfix'>
<a class='menu-button icon-menu' href='#'>
<span class='word'>Menu</span>
</a>
</nav>
</header>
<main class='content' role='main'>
<article class='post'>
<header class='post-header'>
<h1 class='post-title'>ActiveRecord Models</h1>
<section class='post-meta'>
<time class='post-date' datetime='2014-08-19'>
19 August 2014
</time>
on <a href='/tag/rails/'>rails</a>
</section>
</header>
<section class='post-content'><p>This post is a writeup of a <a href="http://www.railsschool.org/">RailsSchool</a> 
<a href="http://www.railsschool.org/l/intro-to-rails-models">class</a> on 14-08-19 on 
ActiveRecord models. </p>

<h2>What is a model?</h2>

<p>In web programming, model generally refers to the “M” in MVC. The model’s job is 
to be an interface to your database. More precisely, the model is a programmatic 
representation of your data structure. This is called an ORM, or 
“object-relational mapping.” Sometimes models include basic logic relating to 
data, such as validations. For example, you might decide that an employee’s 
hourly rate should never be below minimum wage. That logic is something that 
would usually go in a model. </p>

<p>In Ruby on Rails in particular, models are classes that descend from 
ActiveRecord::Base. Instances of these classes represent a single data entity. 
For example, if you are using a traditional SQL database such as PostgreSQL, 
each model will probably represent a specific table. Each instance of the model 
class will represent one row in the table. </p>

<p>ActiveRecord models are defined like so:</p>
<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre> class Customer &lt; ActiveRecord::Base
    # some other stuff goes here     
 end
</pre></td></tr></tbody></table>
</div>

<p>You can create an instance of one of these classes just like any other class:</p>
<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre> new_customer = Customer.new
</pre></td></tr></tbody></table>
</div>

<p>ActiveRecord models create instances where methods and attributes correspond to 
database columns. So something like</p>
<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre> new_customer.first_name = “Ward”
</pre></td></tr></tbody></table>
</div>

<p>will set the first<em>name attribute of the new</em>customer object to “Ward”. In most 
cases this will make it into the database.</p>

<h2>Using ActiveRecord models</h2>

<p>ActiveRecord supplies us with all kinds of useful methods. Let’s explore some of 
the most commonly used. This section should give you a basic sense of how to use 
ActiveRecord in your Rails projects. For more information, see this incredibly 
<a href="http://guides.rubyonrails.org/index.html">useful guide</a>.</p>

<h3>Migrations</h3>

<p>ActiveRecord is an interface to a database, to to use it you will probably first 
create a database and use a migration to add tables, columns, or otherwise 
modify your data structure. Migrations are a topic themselves, the 
<a href="http://guides.rubyonrails.org/index.html">RailsGuide</a> has some more
information.</p>

<h3>Class methods</h3>

<h4>Making new objects</h4>
<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>::new =&gt; creates a new object, but does not save it in the database
::create =&gt; creates a new object, AND saves it in the database
::create! =&gt; same as above, but raises an exception if the object is not saved
</pre></td></tr></tbody></table>
</div>

<h4>Finding existing objects</h4>
<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>::find =&gt; takes an id, returns an object
::where =&gt; takes a hash, returns a collection
::first =&gt; returns the first object
::second =&gt; returns the second object
::last =&gt; returns the last object
::all =&gt; returns all the objects
</pre></td></tr></tbody></table>
</div>

<h4>Destruction</h4>
<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>::destroy_all =&gt; all objects are destroyed by calling #destroy
::delete_all =&gt; objects simply removed from the db. skips callbacks.
</pre></td></tr></tbody></table>
</div>

<h3>Instance methods</h3>
<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>#save =&gt; save the object to the database
#update_attributes =&gt; takes an attributes hash as an argument, updates the attributes, and saves the record
#destroy =&gt; removes the object from the database, and run callbacks
#delete =&gt; just removes the object from the database
</pre></td></tr></tbody></table>
</div>

<p>In addition to a variety of instance methods, ActiveRecords also gives us 
instance methods that correspond to data object attributes (generally columns). 
Things like #first<em>name, etc. Also, we get instance methods that are mapped to 
object relations. For example, some</em>customer.orders, or subscriber.invoices. 
These relation methods can be used to quickly return collections of related data 
objects.</p>

<h2>Creating ActiveRecord models</h2>

<p>ActiveRecord is a large and powerful library. This section is an overview of the 
most comment ActiveRecord features you will use while working with 
Ruby on Rails. </p>

<h3>Naming conventions</h3>

<p>ActiveRecord models are named according to convention, where the class name is 
the singular version of the table name. For example, an AR class called “User” 
would correspond to a database table named &ldquo;users&rdquo;.</p>

<h4>Reserved words</h4>

<p>There are some words you don’t want to use, because they’ll conflict with other 
parts of Rails or Ruby. Class names like Session, Database, Application, would 
be bad. Also, you don’t want to name your attributes things like “transaction” 
or “relationship&quot;.</p>

<h3>Relationships</h3>

<p>Standard SQL relationships are set up using keywords in the ActiveModel class 
declaration. Some examples are:</p>
<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre> class Address &lt; ActiveRecord::Base
      belongs_to :customer
 end

 class Customer &lt; ActiveRecord::Base
      has_many :orders
 end
</pre></td></tr></tbody></table>
</div>

<p>Notice that the declarations use Ruby symbols as arguments, and the symbols 
correspond to other ActiveRecord classes. Notice also that the first 
relationship uses a singular name, while the second uses a plural, as you would 
expect. You can find much more information in the RailsGuide section on 
ActiveRecord relationships. Of particular note is 
the dependent: :destroy argument:</p>
<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre> class Customer &lt; ActiveRecord::Base
      has_many :orders, dependent: :destroy
 end
</pre></td></tr></tbody></table>
</div>

<p>This tells Rails that when a Customer object is destroyed, you also want all the dependent Orders to be destroyed as well. </p>
</section>
<footer class='post-footer'>
<section class='author'>
<h4>
<a href='/author/brad-johnson/'>Brad Johnson</a>
</h4>
<p></p>
Read
<a href='/author/brad-johnson/'>more posts</a>
by this author.
</section>
<section class='share'>
<h4>Share this post</h4>
<a class='icon-twitter' href='https://twitter.com/share?text=ActiveRecord Models&amp;amp;url=http://www.bradleymosesjohnson.com/2014/08/19/rails-models/' onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
<span class='hidden'>Twitter</span>
</a>
<a class='icon-facebook' href='https://www.facebook.com/sharer/sharer.php?u=http://www.bradleymosesjohnson.com/2014/08/19/rails-models/' onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
<span class='hidden'>Facebook</span>
</a>
<a class='icon-google-plus' href='https://plus.google.com/share?url=http://www.bradleymosesjohnson.com/2014/08/19/rails-models/' onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
<span class='hidden'>Google+</span>
</a>
</section>
</footer>
</article>
</main>
<aside class='read-next'>
<a class='no-cover read-next-story' href='/2014/07/09/multitenancy-part-two/'>
<section class='post'>
<h2>Multitenancy Part Two</h2>
<p>In my previous post I wrote about who to create a multi-tenant Rails application using the Pundit gem. I&rsquo;ve&hellip;</p>
</section>
</a>
<a class='no-cover prev read-next-story' href='/2014/10/08/fragment-caching-in-rails-4/'>
<section class='post'>
<h2>Fragment caching in Rails 4</h2>
<p>Recently I implemented a nested caching scheme in a Rails application. I ran into a couple of interesting problems&hellip;</p>
</section>
</a>
</aside>

<footer class='site-footer clearfix'>
<section class='copyright'>
<a href='/'>Brad Johnson</a>
&copy;
2015
</section>
<section class='poweredby'>
Casper theme powered by
<a href='https://ghost.org'>Ghost</a>
</section>
</footer>
</div>
<script src="/javascripts/application.js" type="text/javascript"></script>
</body>
</html>
